generator client {
  provider = "prisma-client"
  output   = "../.generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = "file:../dev.db"
}

enum Currency {
  USD
  GTQ
  ARS
  RON
}

enum UserRole {
  SUPERUSER
  ADMIN
  COORDINATOR // Pastor of the church or US Trip Leader 
  PARTICIPANT
}

enum ExpenseMethod {
  CASH
  CARD
  TRANSFER
}

model ExpenseType {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  expense     Expense[]
}

model CategoryType {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  expense     Expense[]
}

model Expense {
  id             Int           @id @default(autoincrement())
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  merchant       String
  dateOfPurchase DateTime
  currency       Currency
  method         ExpenseMethod
  amount         Decimal
  memo           String?
  upload         String?
  categoryTypeId Int?
  expenseTypeId  Int?
  categoryType   CategoryType? @relation(fields: [categoryTypeId], references: [id])
  expenseType    ExpenseType?  @relation(fields: [expenseTypeId], references: [id])
}

model Profile {
  id                String             @id @default(cuid())
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  email             String
  firstName         String?
  lastName          String?
  churchName        String?
  dob               DateTime?
  street            String?
  city              String?
  state             String?
  postal            String?
  phone             String?
  tripRegistrations TripRegistration[] @relation("ProfileTripRegistration")
}

//This is the TRIP Itself created by the COORDINATOR/ADMIN/SUPERUSER
model Trip {
  id             String             @id @default(cuid())
  code           String             @unique // short code for the trip like "GUAT2025"
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  title          String
  churchName     String?
  location       String?
  startDate      String // "YYYY-MM-DD"   // stored as DATE (no time)
  endDate        String // stored as DATE (no time)
  groupSize      Int?
  description    String?
  createdByEmail String
  createdBy      User               @relation("TripCreatedBy", fields: [createdByEmail], references: [email], onDelete: Cascade)
  createdByRole  UserRole           @default(PARTICIPANT)
  registrations  TripRegistration[]

  @@index([createdByEmail])
}

//This is the participant who is registering for the trip
model TripRegistration {
  id               String    @id @default(cuid())
  registrationType UserRole  @default(PARTICIPANT)
  tripId           String
  trip             Trip      @relation(fields: [tripId], references: [id])
  registrantId     String
  registrant       User      @relation("TripRegistrant", fields: [registrantId], references: [id], onDelete: Cascade)
  primaryContact   String
  dob              DateTime?
  street           String?
  city             String?
  state            String?
  postal           String?
  phone            String?

  profiles Profile[] @relation("ProfileTripRegistration")

  @@index([tripId])
  @@index([registrantId])
}
